!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e||self).reactJsonForm=t()}(this,function(){function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function t(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,a(e,t)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function n(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)t.indexOf(a=l[n])>=0||(r[a]=e[a]);return r}function r(e){var t={},a=e.keys||e.properties;for(var n in a){var o=a[n],i=o.type;"list"===i?i="array":"dict"===i&&(i="object"),t[n]="array"===i?l(o):"object"===i?r(o):"boolean"===i?o.default||!1:"integer"===i||"number"===i?o.default||null:o.default||""}return t}function l(e){var t=[],a=e.items.type;return"list"===a?a="array":"dict"===a&&(a="object"),t.push("array"===a?l(e.items):"object"===a?r(e.items):"boolean"===a?e.items.default||!1:"integer"===a||"number"===a?e.items.default||null:e.items.default||""),t}function o(e){var t=e.type;return"list"===t?t="array":"dict"===t&&(t="object"),"array"===t?l(e):"object"===t?r(e):"boolean"===t?e.default||!1:"integer"===t||"number"===t?e.default||null:e.default||""}function i(e,t){var a=JSON.parse(JSON.stringify(e)),n=t.items.type;"list"===n?n="array":"dict"===n&&(n="object");for(var r=0;r<e.length;r++){var l=e[r];"array"===n?a[r]=i(l,t.items):"object"===n?a[r]=c(l,t.items):"integer"!==n&&"number"!==n||""!==l||(a[r]=null)}return a}function c(e,t){for(var a=JSON.parse(JSON.stringify(e)),n=t.keys||t.properties,r=[].concat(Object.keys(n)),l=0;l<r.length;l++){var o=r[l],s=n[o],u=s.type;"list"===u?u="array":"dict"===u&&(u="object"),a[o]=e.hasOwnProperty(o)?"array"===u?i(e[o],s):"object"===u?c(e[o],s):"integer"!==u&&"number"!==u||""!==e[o]?e[o]:null:"array"===u?i([],s):"object"===u?c({},s):"boolean"!==u&&("integer"===u||"number"===u?null:"")}return a}var s=["className"];function u(t){var a=t.className,r=n(t,s);a||(a="");var l=a.split(" ");a="";for(var o=0;o<l.length;o++)a=a+"rjf-"+l[o]+"-button ";return React.createElement("button",e({className:a.trim(),type:"button"},r),r.children)}function d(e){return React.createElement("div",{className:"rjf-loader"})}var m=React.createContext();function p(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""}var f=["label","help_text","error","inputRef"],h=["label","help_text","error","value"],v=["label","help_text","error","value","options"],y=["label","help_text","error","value","options"],b=["label","value"],g=["label","help_text","error","inputRef"];function R(e){var t=e.label,a=e.inputRef,r=n(e,f);return"string"===r.type&&(r.type="text"),a&&(r.ref=a),null===r.value&&(r.value=""),React.createElement("div",null,t&&React.createElement("label",null,t),React.createElement("input",r))}function E(e){var t=e.label,a=e.value,r=n(e,h);return t||(t=r.name.toUpperCase()),"bool"===r.type&&(r.type="checkbox"),void 0===r.checked&&(r.checked=a),""!==r.checked&&null!=r.checked||(r.checked=!1),r.readOnly&&(r.disabled=!0),React.createElement("div",null,React.createElement("label",null,React.createElement("input",r)," ",t))}function N(t){var a=t.label,r=t.value,l=t.options,o=n(t,v);return o.readOnly&&(o.disabled=!0),React.createElement("div",null,React.createElement("label",null,a),l.map(function(t,a){var n,l;return"object"==typeof t?(n=t.label,l=t.value):("boolean"==typeof(n=t)&&(n=p(n.toString())),l=t),React.createElement("label",{key:n+"_"+l+"_"+a},React.createElement("input",e({},o,{value:l,checked:l===r}))," ",n)}))}function k(t){var a=t.label,r=t.value,l=t.options,o=n(t,y);return o.readOnly&&(o.disabled=!0),React.createElement("div",null,a&&React.createElement("label",null,a),React.createElement("select",e({value:r||""},o),React.createElement("option",{disabled:!0,value:"",key:"__placehlder"},"Select..."),l.map(function(e,t){var a,n;return"object"==typeof e?(a=e.label,n=e.value):("boolean"==typeof(a=e)&&(a=p(a.toString())),n=e),React.createElement("option",{value:n,key:a+"_"+n+"_"+t},a)})))}var j=function(a){function r(e){var t;return(t=a.call(this,e)||this).getFileName=function(){return t.props.value?"data-url"===t.props.type?t.extractFileInfo(t.props.value).name:"file-url"===t.props.type?t.props.value:"Unknown file":""},t.extractFileInfo=function(e){var t=function(e){var t,a=e.split(","),n=a[0].split(";"),r=n[0].replace("data:",""),l=n.filter(function(e){return"name"===e.split("=")[0]});t=1!==l.length?"unknown":l[0].split("=")[1];for(var o=atob(a[1]),i=[],c=0;c<o.length;c++)i.push(o.charCodeAt(c));return{blob:new window.Blob([new Uint8Array(i)],{type:r}),name:t}}(e),a=t.blob;return{name:t.name,size:a.size,type:a.type}},t.addNameToDataURL=function(e,t){return e.replace(";base64",";name="+encodeURIComponent(t)+";base64")},t.handleChange=function(e){if("data-url"===t.props.type){var a=e.target.files[0],n=a.name,r=new FileReader;r.onload=function(){var e={target:{type:"text",value:t.addNameToDataURL(r.result,n),name:t.props.name}};t.props.onChange(e)},r.readAsDataURL(a)}else if("file-url"===t.props.type){var l=t.context.fileUploadEndpoint;if(!l)return console.error("Error: fileUploadEndpoint option need to be passed while initializing editor for enabling file uploads."),void alert("Files can't be uploaded.");t.setState({loading:!0});var o=new FormData;o.append("field_name",t.context.fieldName),o.append("model_name",t.context.modelName),o.append("coordinates",JSON.stringify(t.props.name.split("-").slice(1))),o.append("file",e.target.files[0]),fetch(l,{method:"POST",headers:{"X-CSRFToken":document.cookie.split(";").filter(function(e){return 0===e.trim().indexOf("csrftoken=")}).length?document.cookie.split(";").filter(function(e){return 0===e.trim().indexOf("csrftoken=")})[0].split("=")[1]:null},body:o}).then(function(e){return e.json()}).then(function(e){t.props.onChange({target:{type:"text",value:e.file_path,name:t.props.name}}),t.setState({loading:!1})}).catch(function(e){alert("Something went wrong while uploading file"),console.error("Error:",e),t.setState({loading:!1})})}},t.showFileBrowser=function(){t.inputRef.current.click()},t.state={value:e.value,fileName:t.getFileName(),loading:!1},t.inputRef=React.createRef(),t}t(r,a);var l=r.prototype;return l.componentDidUpdate=function(e,t){this.props.value!==e.value&&this.setState({value:this.props.value,fileName:this.getFileName()})},l.render=function(){var t=e({value:r},this.props),a=t.label,r=t.value,l=n(t,b);return l.type="file",l.onChange=this.handleChange,l.readOnly&&(l.disabled=!0),React.createElement("div",null,a&&React.createElement("label",null,a),React.createElement("div",{className:"rjf-file-field"},this.state.value&&React.createElement("div",{className:"rjf-current-file-name"},"Current file: ",React.createElement("span",null,this.state.fileName)),this.state.value&&!this.state.loading&&"Change:",this.state.loading?React.createElement("div",{className:"rjf-file-field-loading"},React.createElement(d,null)," Uploading..."):React.createElement("div",{className:"rjf-file-field-input"},React.createElement(R,e({},l,{inputRef:this.inputRef})))))},r}(React.Component);function w(e){var t=e.label,a=e.inputRef,r=n(e,g);return delete r.type,a&&(r.ref=a),React.createElement("div",null,t&&React.createElement("label",null,t),React.createElement("textarea",r))}function O(e){return e.children?React.createElement("div",{className:"rjf-form-group-title"},e.children):null}function C(e){return React.createElement("div",{className:"rjf-form-row-controls"},e.onMoveUp&&React.createElement(u,{className:"move-up",onClick:e.onMoveUp,title:"Move up"},React.createElement("span",null,"↑")),e.onMoveDown&&React.createElement(u,{className:"move-down",onClick:e.onMoveDown,title:"Move down"},React.createElement("span",null,"↓")),e.onRemove&&React.createElement(u,{className:"remove",onClick:e.onRemove,title:"Remove"},React.createElement("span",null,"×")))}function x(e){return React.createElement("div",{className:"rjf-form-row"},React.createElement(C,e),React.createElement("div",{className:"rjf-form-row-inner"},e.children))}function S(e){var t=React.Children.count(e.children),a=0!==e.level||t?"rjf-form-group-inner":"";return React.createElement("div",{className:"rjf-form-group"},0===e.level&&React.createElement(O,null,e.schema.title),React.createElement("div",{className:a},e.level>0&&React.createElement(O,null,e.schema.title),e.children,e.addable&&React.createElement(u,{className:"add",onClick:function(t){return e.onAdd()},title:"Add new"},t?"Add more":"Add")))}function _(t){var a,n={name:t.name,value:t.data,readOnly:t.schema.readOnly||t.schema.readonly},r=t.schema.type;switch(t.schema.choices&&(n.options=t.schema.choices,r="select"),t.schema.widget&&(r=t.schema.widget),r){case"string":a=R,t.schema.format?("data-url"!==t.schema.format&&"file-url"!==t.schema.format||(a=j),n.type=t.schema.format):n.type="text";break;case"number":n.type="number",a=R;break;case"integer":n.type="number",n.step="1",a=R;break;case"boolean":case"checkbox":n.type="checkbox",a=E;break;case"radio":n.type="radio",a=N;break;case"select":a=k;break;case"textarea":a=w;break;default:n.type="text",a=R}return React.createElement(a,e({},n,{label:t.editable?React.createElement("span",null,t.schema.title," ",React.createElement(u,{className:"edit",onClick:t.onEdit,title:"Edit"},"Edit")):t.schema.title,onChange:function(e){return function(e,t,a){var n;n="checkbox"===e.target.type?e.target.checked:e.target.value,"number"===t||"integer"===t?""===(n=n.trim())?n=null:isNaN(Number(n))||(n=Number(n)):"boolean"===t&&(n="false"!==n&&!1!==n),a(e.target.name,n)}(e,t.schema.type,t.onChange)}}))}function A(e){var t=e.name,a=e.onRemove;return React.createElement(x,{key:t,onRemove:e.removable?function(e){return a(t)}:null,onMoveUp:e.onMoveUp,onMoveDown:e.onMoveDown},React.createElement(_,{data:e.data,schema:e.schema,name:t,onChange:e.onChange,onEdit:e.onEdit,editable:e.editable}))}function I(e){var t=e.data,a=e.schema,n=e.name,r=e.onAdd,l=e.onRemove,i=e.onMove,c=e.level,s=[],d=[],m=!0;t.length<=(a.min_items||a.minItems||0)&&(m=!1);var p=!0;t.length>=(a.max_items||a.maxItems||100)&&(p=!1);var f=a.items.type;"list"===f?f="array":"dict"===f&&(f="object");for(var h={schema:a.items,onChange:e.onChange,onAdd:r,onRemove:l,level:c+1,removable:m,onMove:i},v=function(e){h.data=t[e],h.name=n+"-"+e,h.onMoveUp=0===e?null:function(t){return i(n+"-"+e,n+"-"+(e-1))},h.onMoveDown=e===t.length-1?null:function(t){return i(n+"-"+e,n+"-"+(e+1))},"array"===f?d.push(I(h)):"object"===f?d.push(U(h)):s.push(A(h))},y=0;y<t.length;y++)v(y);var b=n;return(s.length||!s.length&&!d.length)&&(s=React.createElement(S,{level:c,schema:a,addable:p,onAdd:function(){return r(o(a.items),b)},key:"row_group_"+n},s)),d.length&&(d=React.createElement("div",{key:"group_"+n},a.title?React.createElement("div",{className:"rjf-form-group-title"},a.title):null,d.map(function(e,t){return React.createElement("div",{className:"rjf-form-group-wrapper",key:"group_wrapper_"+n+"_"+t},React.createElement(C,{onRemove:m?function(e){return l(n+"-"+t)}:null,onMoveUp:t>0?function(e){return i(n+"-"+t,n+"-"+(t-1))}:null,onMoveDown:t<d.length-1?function(e){return i(n+"-"+t,n+"-"+(t+1))}:null}),e)}),p&&React.createElement(u,{className:"add",onClick:function(e){return r(o(a.items),b)},title:"Add new"},"Add item"))),[].concat(s,d)}function U(e){var t=e.data,a=e.schema,n=e.name,r=e.onChange,l=e.onAdd,o=e.onRemove,i=e.level,c=e.onMove,s=[],u=a.keys||a.properties,d=[].concat(Object.keys(u));a.additionalProperties&&(d=[].concat(d,Object.keys(t).filter(function(e){return-1===d.indexOf(e)})));for(var m=function(e){var a=d[e],m=t[a],f=n+"-"+a,h=u[a]||{type:"string"},v=h.type;"list"===v?v="array":"dict"===v&&(v="object"),h.title||(h.title=function(e){return null==e?"":p(e=e.replace(/_/g," "))}(a));var y=!1;void 0===u[a]&&(y=!0);var b={data:m,schema:h,name:f,onChange:r,onAdd:l,onRemove:o,level:i+1,removable:y,onMove:c};"array"===v?s.push(I(b)):"object"===v?s.push(U(b)):(b.onEdit=function(){return F(t,a,m,f,l,o)},b.editable=y,s.push(A(b)))},f=0;f<d.length;f++)m(f);if(s.length||a.additionalProperties){var h=n;s=React.createElement(S,{level:i,schema:a,addable:a.additionalProperties,onAdd:function(){return function(e,t,a){var n=prompt("Add new key");null!==n&&((n=n.trim())?e.hasOwnProperty(n)?alert("(!) Duplicate keys not allowed. This key already exists.\r\n\r\n‎"):a("",t+"-"+n):alert("(!) Can't add empty key.\r\n\r\n‎"))}(t,h,l)},key:"row_group_"+n},s)}return s}function F(e,t,a,n,r,l){var o=prompt("Rename key",t);if(null!==o&&(o=o.trim())!==t){if(!o)return alert("(!) Key name can't be empty.\r\n\r\n‎");if(e.hasOwnProperty(o))return alert("(!) Duplicate keys not allowed. This key already exists.\r\n\r\n‎");r(a,name+"-"+o),l(n)}}j.contextType=m;var M=function(e){function a(t){var a;(a=e.call(this,t)||this).populateDataInput=function(){a.dataInput.value=JSON.stringify(a.state.data)},a.handleChange=function(e,t){(e=e.split("-")).shift();var n=JSON.parse(JSON.stringify(a.state.data));!function e(t,a,n){var r=t.shift();isNaN(Number(r))||(r=Number(r)),t.length?e(t,a[r],n):a[r]=n}(e,n,t),a.setState({data:n})},a.getFields=function(){var e=a.state.data,t=[];try{var n=a.schema.type;"list"===n?n="array":"dict"===n&&(n="object");var r={data:e,schema:a.schema,name:"rjf",onChange:a.handleChange,onAdd:a.addFieldset,onRemove:a.removeFieldset,onMove:a.moveFieldset,level:0};if("array"===n)return I(r);if("object"===n)return U(r)}catch(e){t=React.createElement("p",{style:{color:"#f00"}},React.createElement("strong",null,"(!) Error:")," Schema and data structure do not match.")}return t},a.addFieldset=function(e,t){(t=t.split("-")).shift(),a.setState(function(a){var n=JSON.parse(JSON.stringify(a.data));return D(t,n,e),{data:n}})},a.removeFieldset=function(e){(e=e.split("-")).shift(),a.setState(function(t){var a=JSON.parse(JSON.stringify(t.data));return J(e,a),{data:a}})},a.moveFieldset=function(e,t){(e=e.split("-")).shift(),(t=t.split("-")).shift(),a.setState(function(a){var n=JSON.parse(JSON.stringify(a.data));return P(e,t,n),{data:n}})},a.dataInput=document.getElementById(a.props.dataInputId),a.schema=t.schema;var n,r,l,s=t.data;if(s)try{n=s,"list"===(l=(r=a.schema).type)?l="array":"dict"===l&&(l="object"),s="array"===l?i(n,r):"object"===l?c(n,r):n}catch(e){console.error("Error: Schema and data structure don't match"),console.error(e)}else s=o(a.schema);return a.state={value:"",data:s},a.populateDataInput(),a}t(a,e);var n=a.prototype;return n.componentDidUpdate=function(e,t){this.state.data!==t.data&&this.populateDataInput()},n.render=function(){return React.createElement("div",{className:"rjf-form-wrapper"},React.createElement("fieldset",{className:"module aligned"},React.createElement(m.Provider,{value:{fileUploadEndpoint:this.props.fileUploadEndpoint,fieldName:this.props.fieldName,modelName:this.props.modelName}},this.getFields())))},a}(React.Component);function D(e,t,a){var n=e.shift();isNaN(Number(n))||(n=Number(n)),e.length?D(e,t[n],a):Array.isArray(t[n])?t[n].push(a):Array.isArray(t)?t.push(a):t[n]=a}function J(e,t){var a=e.shift();isNaN(Number(a))||(a=Number(a)),e.length?J(e,t[a]):Array.isArray(t)?t.splice(a,1):delete t[a]}function P(e,t,a){var n=e.shift();if(isNaN(Number(n))||(n=Number(n)),e.length)P(e,t,a[n]);else if(Array.isArray(a)){var r=t[t.length-1],l=a[n];a.splice(n,1),a.splice(r,0,l)}}return{JSONForm:function(e){this.containerId=e.containerId,this.dataInputId=e.dataInputId,this.schema=e.schema,this.data=e.data,this.fileUploadEndpoint=e.fileUploadEndpoint,this.fieldName=e.fieldName,this.modelName=e.modelName,this.render=function(){ReactDOM.render(React.createElement(M,{schema:this.schema,dataInputId:this.dataInputId,data:this.data,fileUploadEndpoint:this.fileUploadEndpoint,fieldName:this.fieldName,modelName:this.modelName}),document.getElementById(this.containerId))}}}});
//# sourceMappingURL=react-json-form.min.js.map
